/* public/css/print.css - Version pour impression HTML */
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Roboto+Mono:wght@700&display=swap');
@import url('https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css');

:root {
    --grid-gap: 4mm;
}

body {
    font-family: 'Roboto', sans-serif;
    background-color: #f0f0f0;
    margin: 0;
}

.page-container {
    margin: 1rem auto;
    padding: 10mm;
    background-color: white;
    width: 210mm;
    min-height: calc(297mm - 2 * 10mm);
    box-sizing: border-box;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

.print-header {
    text-align: center;
    margin-bottom: 2rem;
    border-bottom: 1px solid #ccc;
    padding-bottom: 1rem;
}

.page-title { font-size: 18pt; font-weight: bold; margin: 0; }
.print-meta { margin-top: 0.5rem; color: #666; font-size: 9pt; display: flex; justify-content: space-between; align-items: center; }
.print-meta button { padding: 8px 12px; border: 1px solid #ccc; background-color: #f0f0f0; border-radius: 4px; cursor: pointer; }

/* Styles communs des étiquettes (inchangés) */
.print-grid { display: grid; gap: var(--grid-gap); }
.print-item { border: 1px solid #333; padding: 2mm; box-sizing: border-box; display: flex; overflow: hidden; page-break-inside: avoid; background: white; }
body.with-cut-lines .print-item { border: 1px dashed #cccccc; }

/* ... (tous les styles de template .template-qr-left, .template-qr-top, etc. restent inchangés) ... */
.template-qr-left { height: 40mm; flex-direction: row; align-items: center; gap: 3mm; }
.template-qr-left .print-qr-code { flex: 0 0 35mm; }
.template-qr-left .print-details { flex-grow: 1; }
.template-qr-left .print-code { font-size: 16pt; }
.template-qr-left .print-libelle { font-size: 11pt; }
.template-qr-top { height: 55mm; flex-direction: column; text-align: center; gap: 2mm; }
.template-qr-top .print-qr-code { flex: 0 0 35mm; }
.template-qr-top .print-details { flex-grow: 1; }
.template-qr-top .print-code { font-size: 14pt; }
.template-qr-top .print-libelle { font-size: 10pt; }
.template-compact { height: 25mm; flex-direction: row; align-items: center; gap: 3mm; }
.template-compact .print-qr-code { flex: 0 0 20mm; }
.template-compact .print-details { flex-grow: 1; }
.template-compact .print-code { font-size: 12pt; }
.template-compact .print-libelle { font-size: 8pt; }
.print-qr-code { height: 100%; display: flex; align-items: center; justify-content: center; }
.print-qr-code canvas { max-width: 100%; max-height: 100%; object-fit: contain; }
.print-details { display: flex; flex-direction: column; justify-content: center; gap: 1mm; font-size: 10pt; word-break: break-word; overflow: hidden; }
.print-code { font-family: 'Roboto Mono', monospace; font-weight: 700; color: #000; }
.print-libelle { font-weight: bold; }
.print-univers, .print-comment { font-size: 9pt; color: #444; }
.print-comment { font-style: italic; }

/* --- STYLES SPÉCIFIQUES À L'IMPRESSION --- */
@media print {
    body { 
        background-color: white; 
        /* Initialise le compteur de page total */
        counter-reset: page-total;
    }
    .no-print { display: none !important; }
    .page-container {
        margin: 0; padding: 0; width: 100%; min-height: 100%;
        box-shadow: none; border: none;
    }

    /* Gestion des sauts de page */
    .univers-container {
        /* Un conteneur d'univers doit commencer sur une nouvelle page et on y réinitialise son propre compteur */
        page-break-before: always;
        counter-reset: page-in-univers;
    }
    .univers-container:first-child {
        /* Sauf pour le tout premier */
        page-break-before: auto;
    }
    .univers-title {
        page-break-after: avoid; 
    }
    .univers-group {
        /* Ceci force chaque section à être traitée comme un bloc de pagination, incrémentant les compteurs */
        page-break-before: always;
        counter-increment: page-total;
    }
    .univers-group:first-child {
        page-break-before: auto;
    }
    /* S'il n'y a pas de séparation, le conteneur ne force pas de saut */
    body:not(.separate-univers-print) .univers-container {
        page-break-before: auto;
    }

    /* En-tête et pied de page */
    .print-page-header, .print-page-footer {
        display: block;
        position: fixed;
        left: 0;
        right: 0;
        width: 100%;
        font-size: 9pt;
        color: #888;
    }
    .print-page-header {
        top: -8mm; /* Positionné dans la marge du haut */
        text-align: center;
    }
    .print-page-footer {
        bottom: -8mm; /* Positionné dans la marge du bas */
        text-align: center;
    }
    
    /* Logique des compteurs de pages */
    .page-number-in-univers::before {
        counter-increment: page-in-univers;
        content: counter(page-in-univers);
    }
    .total-pages-in-univers::before {
        /* Ce compteur sera rempli par le JavaScript, pas besoin de CSS */
        content: counter(pages-in-univers);
    }
    .page-number-total::before {
        content: counter(page-total);
    }
    .total-pages::before {
        content: counter(pages-total);
    }
}
